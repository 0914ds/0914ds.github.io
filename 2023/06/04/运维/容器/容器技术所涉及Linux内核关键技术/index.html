<!DOCTYPE html>
<html lang="en">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="å®¹å™¨æŠ€æœ¯æ‰€æ¶‰åŠLinuxå†…æ ¸å…³é”®æŠ€æœ¯" />
    <meta name="hexo-theme-A4" content="v1.9.7" />
    <link rel="alternate icon" type="image/webp" href="../../../../../../img/favicon.webp">
    <title>blog</title>

    
        
<link rel="stylesheet" href="../../../../../../css/highlight/style1.css">

        
<link rel="stylesheet" href="../../../../../../css/reset.css">

        
<link rel="stylesheet" href="../../../../../../css/markdown.css">

        
<link rel="stylesheet" href="../../../../../../css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="../../../../../../css/ui.css">
 
        
<link rel="stylesheet" href="../../../../../../css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="../../../../../../css/returnToTop.css">

            
<link rel="stylesheet" href="../../../../../../css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="../../../../../../css/toc.css">

        
    

    
        
<link rel="stylesheet" href="../../../../../../css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="../../../../../../css/lightgallery-bundle.min.css">


   
        
<link rel="stylesheet" href="../../../../../../css/custom.css">

    

<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="atom.xml" title="blog" type="application/atom+xml">
</head>
    
    
        <style>
            .index-main{
                max-width:  880px;
            }
        </style>

    
    



    

    
    




    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #e4e4e4 ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'ğŸŒ“', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <style>
            .header-img {
                width: 56px;
                height: auto;
                object-fit: cover; /* ä¿æŒå›¾ç‰‡æ¯”ä¾‹ */
                transition: transform 0.3s ease-in-out; 
                border-radius: 0; 
            }
            
        </style>
        <img 
            alt="^-^" 
            cache-control="max-age=86400" 
            class="header-img" 
            src="../../../../../../img/favicon.webp" 
        />
        <div class="header-content">
            <a class="logo" href="../../../../../../index.html">blog</a> 
            <span class="description"></span> 
        </div>
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="../../../../../../index.html">é¦–é¡µ</a></li>
            
        
            
                <li><a href="../../../../../../list/">æ–‡ç« </a></li>
            
        
            
                <li><a href="../../../../../../about/">å…³äº</a></li>
            
        
            
                <li><a href="../../../../../../tags/">æ ‡ç­¾</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">
    

    
        
            
                <div class="post-main-title" style="text-align: center;">
                    å®¹å™¨æŠ€æœ¯æ‰€æ¶‰åŠLinuxå†…æ ¸å…³é”®æŠ€æœ¯
                </div>
            
        
      
    

    

        
            <div class="post-head-meta-center">
        
                
                    <span>æœ€è¿‘æ›´æ–°ï¼š2023-06-22</span> 
                
                
                    
                        &nbsp; | &nbsp;
                    
                     <span>å­—æ•°æ€»è®¡ï¼š3.9k</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span>é˜…è¯»ä¼°æ—¶ï¼š16åˆ†é’Ÿ</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span id="busuanzi_container_page_pv">
                        é˜…è¯»é‡ï¼š<span id="busuanzi_value_page_pv"></span>æ¬¡
                    </span>
                
            </div>
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link"><span class="post-toc-text">å®¹å™¨æŠ€æœ¯æ‰€æ¶‰åŠLinuxå†…æ ¸å…³é”®æŠ€æœ¯</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link"><span class="post-toc-text">ä¸€ã€å®¹å™¨æŠ€æœ¯å‰ä¸–ä»Šç”Ÿ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-1-1979%E5%B9%B4-%E2%80%94-chroot"><span class="post-toc-text">1.1 1979å¹´ â€” chroot</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-2-2000%E5%B9%B4-%E2%80%94-FreeBSD-Jails"><span class="post-toc-text">1.2 2000å¹´ â€” FreeBSD Jails</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-3-2001%E5%B9%B4-%E2%80%94-Linux-VServer"><span class="post-toc-text">1.3 2001å¹´ â€” Linux VServer</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-4-2004%E5%B9%B4-%E2%80%94-Solaris%E5%AE%B9%E5%99%A8"><span class="post-toc-text">1.4 2004å¹´ â€” Solariså®¹å™¨</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-5-2005%E5%B9%B4-%E2%80%94-OpenVZ"><span class="post-toc-text">1.5 2005å¹´ â€” OpenVZ</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-6-2006%E5%B9%B4-%E2%80%94-Process%E5%AE%B9%E5%99%A8"><span class="post-toc-text">1.6 2006å¹´ â€” Processå®¹å™¨</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-7-2007%E5%B9%B4-%E2%80%94-Control-Groups"><span class="post-toc-text">1.7 2007å¹´ â€” Control Groups</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-8-2008%E5%B9%B4-%E2%80%94-LXC"><span class="post-toc-text">1.8 2008å¹´ â€” LXC</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-9-2011%E5%B9%B4-%E2%80%94-Warden"><span class="post-toc-text">1.9 2011å¹´ â€” Warden</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-10-2013%E5%B9%B4-%E2%80%94-LMCTFY"><span class="post-toc-text">1.10 2013å¹´ â€” LMCTFY</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-11-2013%E5%B9%B4-Docker"><span class="post-toc-text">1.11 2013å¹´-Docker</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link"><span class="post-toc-text">äºŒã€NameSpace</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-1-NameSpace%E4%BB%8B%E7%BB%8D"><span class="post-toc-text">2.1 NameSpaceä»‹ç»</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-2-Linux%E7%B3%BB%E7%BB%9F%E4%B8%ADNameSpace%E5%88%86%E7%B1%BB"><span class="post-toc-text">2.2 Linuxç³»ç»Ÿä¸­NameSpaceåˆ†ç±»</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-3-NameSpace%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="post-toc-text">2.3 NameSpaceåº”ç”¨æ¡ˆä¾‹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-3-1-%E5%88%9B%E5%BB%BAnet%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="post-toc-text">2.3.1 åˆ›å»ºnetå‘½åç©ºé—´</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-3-2-%E5%88%A0%E9%99%A4net%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="post-toc-text">2.3.2 åˆ é™¤netå‘½åç©ºé—´</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-3-3-%E5%9C%A8net%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%AD%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="post-toc-text">2.3.3 åœ¨netå‘½åç©ºé—´ä¸­æ‰§è¡Œå‘½ä»¤</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-3-4-%E5%9C%A8net%E5%91%BD%E4%BB%A4%E7%A9%BA%E9%97%B4%E4%B8%AD%E6%89%A7%E8%A1%8C%E6%9F%A5%E7%9C%8B%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5-%E7%BD%91%E5%8D%A1-%E5%91%BD%E4%BB%A4"><span class="post-toc-text">2.3.4 åœ¨netå‘½ä»¤ç©ºé—´ä¸­æ‰§è¡ŒæŸ¥çœ‹ç½‘ç»œè¿æ¥(ç½‘å¡)å‘½ä»¤</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-3-5-%E9%80%80%E5%87%BA%E5%BD%93%E5%89%8D%E7%9A%84net%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="post-toc-text">2.3.5 é€€å‡ºå½“å‰çš„netå‘½åç©ºé—´</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-3-6-%E5%9C%A8net%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%AD%E6%89%A7%E8%A1%8C%E5%A4%9A%E6%9D%A1%E5%91%BD%E4%BB%A4"><span class="post-toc-text">2.3.6 åœ¨netå‘½åç©ºé—´ä¸­æ‰§è¡Œå¤šæ¡å‘½ä»¤</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-3-7-%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E7%BD%91%E5%8D%A1"><span class="post-toc-text">2.3.7 åˆ›å»ºè™šæ‹Ÿç½‘å¡</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-3-8-%E8%BF%81%E7%A7%BB%E8%99%9A%E6%8B%9F%E7%BD%91%E5%8D%A1%E5%88%B0%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%AD"><span class="post-toc-text">2.3.8 è¿ç§»è™šæ‹Ÿç½‘å¡åˆ°å‘½åç©ºé—´ä¸­</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-3-9-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%AD%E8%BF%81%E5%87%BA%E8%99%9A%E6%8B%9F%E7%BD%91%E5%8D%A1"><span class="post-toc-text">2.3.9 å‘½åç©ºé—´ä¸­è¿å‡ºè™šæ‹Ÿç½‘å¡</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-3-10-%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E7%BD%91%E5%8D%A1IP%E5%9C%B0%E5%9D%80"><span class="post-toc-text">2.3.10 é…ç½®è™šæ‹Ÿç½‘å¡IPåœ°å€</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link"><span class="post-toc-text">ä¸‰ã€CGroups</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3-1-CGroups%E4%BB%8B%E7%BB%8D"><span class="post-toc-text">3.1 CGroupsä»‹ç»</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3-2-CGroups%E5%8A%9F%E8%83%BD"><span class="post-toc-text">3.2 CGroupsåŠŸèƒ½</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3-3-CGroups%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="post-toc-text">3.3 CGroupsåº”ç”¨æ¡ˆä¾‹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-3-1-%E5%AE%89%E8%A3%85%E5%8F%8A%E5%BC%80%E5%90%AF%E6%9C%8D%E5%8A%A1"><span class="post-toc-text">3.3.1 å®‰è£…åŠå¼€å¯æœåŠ¡</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-3-2-%E9%99%90%E5%88%B6%E8%BF%9B%E7%A8%8B%E4%BD%BF%E7%94%A8CPU"><span class="post-toc-text">3.3.2 é™åˆ¶è¿›ç¨‹ä½¿ç”¨CPU</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-3-2-1-%E6%9F%A5%E7%9C%8Bcpu-shares"><span class="post-toc-text">3.3.2.1 æŸ¥çœ‹cpu shares</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-3-2-2-%E4%BD%BF%E7%94%A8CPU%E5%AD%90%E7%B3%BB%E7%BB%9F%E5%88%9B%E5%BB%BA2%E4%B8%AAgroup%E5%88%86%E7%BB%84"><span class="post-toc-text">3.3.2.2 ä½¿ç”¨CPUå­ç³»ç»Ÿåˆ›å»º2ä¸ªgroupåˆ†ç»„</span></a></li></ol></li></ol></li></ol></li></ol>
            
        
        <div class=".article-gallery"><h1>å®¹å™¨æŠ€æœ¯æ‰€æ¶‰åŠLinuxå†…æ ¸å…³é”®æŠ€æœ¯</h1>
<h1>ä¸€ã€å®¹å™¨æŠ€æœ¯å‰ä¸–ä»Šç”Ÿ</h1>
<h2 id="1-1-1979å¹´-â€”-chroot">1.1 1979å¹´ â€” chroot</h2>
<ul>
<li>å®¹å™¨æŠ€æœ¯çš„æ¦‚å¿µå¯ä»¥è¿½æº¯åˆ°1979å¹´çš„UNIX chrootã€‚</li>
<li>å®ƒæ˜¯ä¸€å¥—â€œUNIXæ“ä½œç³»ç»Ÿâ€ç³»ç»Ÿï¼Œæ—¨åœ¨å°†å…¶rootç›®å½•åŠå…¶å®ƒå­ç›®å½•å˜æ›´è‡³æ–‡ä»¶ç³»ç»Ÿå†…çš„æ–°ä½ç½®ï¼Œä¸”åªæ¥å—ç‰¹å®šè¿›ç¨‹çš„è®¿é—®ã€‚</li>
<li>è¿™é¡¹åŠŸèƒ½çš„è®¾è®¡ç›®çš„åœ¨äºä¸ºæ¯ä¸ªè¿›ç¨‹æä¾›ä¸€å¥—éš”ç¦»åŒ–ç£ç›˜ç©ºé—´ã€‚</li>
<li>1982å¹´å…¶è¢«æ·»åŠ è‡³BSDå½“ä¸­ã€‚</li>
</ul>
<h2 id="1-2-2000å¹´-â€”-FreeBSD-Jails">1.2 2000å¹´ â€” FreeBSD Jails</h2>
<ul>
<li>FreeBSD Jailsæ˜¯ç”±Derrick T. Woolworthäº2000å¹´åœ¨FreeBSDç ”å‘åä¼šä¸­æ„å»ºè€Œæˆçš„æ—©æœŸå®¹å™¨æŠ€æœ¯ä¹‹ä¸€ã€‚</li>
<li>è¿™æ˜¯ä¸€å¥—â€œæ“ä½œç³»ç»Ÿâ€ç³»ç»Ÿï¼Œä¸chrootçš„å®šä½ç±»ä¼¼ï¼Œä¸è¿‡å…¶ä¸­åŒ…å«æœ‰å…¶å®ƒè¿›ç¨‹æ²™ç®±æœºåˆ¶ä»¥å¯¹æ–‡ä»¶ç³»ç»Ÿã€ç”¨æˆ·åŠç½‘ç»œç­‰èµ„æºè¿›è¡Œéš”ç¦»ã€‚</li>
<li>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå®ƒèƒ½å¤Ÿä¸ºæ¯ä¸ªJailã€å®šåˆ¶åŒ–è½¯ä»¶å®‰è£…åŒ…ä¹ƒè‡³é…ç½®æ–¹æ¡ˆç­‰æä¾›ä¸€ä¸ªå¯¹åº”çš„IPåœ°å€ã€‚</li>
</ul>
<h2 id="1-3-2001å¹´-â€”-Linux-VServer">1.3 2001å¹´ â€” Linux VServer</h2>
<ul>
<li>Linux VServerå±äºå¦ä¸€ç§jailæœºåˆ¶ï¼Œå…¶èƒ½å¤Ÿè¢«ç”¨äºä¿æŠ¤è®¡ç®—æœºç³»ç»Ÿä¹‹ä¸Šå„åˆ†åŒºèµ„æºçš„å®‰å…¨(åŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿã€CPUæ—¶é—´ã€ç½‘ç»œåœ°å€ä»¥åŠå†…å­˜ç­‰)ã€‚</li>
<li>æ¯ä¸ªåˆ†åŒºè¢«ç§°ä¸ºä¸€å¥—å®‰å…¨èƒŒæ™¯(security context)ï¼Œè€Œå…¶ä¸­çš„è™šæ‹ŸåŒ–ç³»ç»Ÿåˆ™è¢«ç§°ä¸ºä¸€å¥—è™šæ‹Ÿç§æœ‰æœåŠ¡å™¨ã€‚</li>
</ul>
<h2 id="1-4-2004å¹´-â€”-Solariså®¹å™¨">1.4 2004å¹´ â€” Solariså®¹å™¨</h2>
<ul>
<li>Solariså®¹å™¨è¯ç”Ÿä¹‹æ—¶é¢å‘x86ä¸SPARCç³»ç»Ÿæ¶æ„ï¼Œå…¶æœ€åˆäº®ç›¸äº2004å¹´2æœˆçš„Solaris 10 Build 51 betaå½“ä¸­ï¼Œéšåäº2005å¹´æ­£å¼ç™»é™†Solaris 10çš„å®Œæ•´ç‰ˆæœ¬ã€‚</li>
<li>Solariså®¹å™¨ç›¸å½“äºå°†ç³»ç»Ÿèµ„æºæ§åˆ¶ä¸ç”±åˆ†åŒºæä¾›çš„è¾¹ç•ŒåŠ ä»¥ç»“åˆã€‚å„åˆ†åŒºç«‹è¶³äºå•ä¸€æ“ä½œç³»ç»Ÿå®ä¾‹ä¹‹å†…ä»¥å®Œå…¨éš”ç¦»çš„è™šæ‹ŸæœåŠ¡å™¨å½¢å¼è¿è¡Œã€‚</li>
</ul>
<h2 id="1-5-2005å¹´-â€”-OpenVZ">1.5 2005å¹´ â€” OpenVZ</h2>
<ul>
<li>OpenVZä¸Solariså®¹å™¨éå¸¸ç›¸ä¼¼ï¼Œä¸”ä½¿ç”¨å®‰è£…æœ‰è¡¥ä¸çš„Linuxå†…æ ¸ä»¥å®ç°è™šæ‹ŸåŒ–ã€éš”ç¦»èƒ½åŠ›ã€èµ„æºç®¡ç†ä»¥åŠæ£€æŸ¥ç‚¹äº¤ä»˜ã€‚</li>
<li>æ¯å¥—OpenVZå®¹å™¨æ‹¥æœ‰ä¸€å¥—éš”ç¦»åŒ–æ–‡ä»¶ç³»ç»Ÿã€ç”¨æˆ·ä¸ç”¨æˆ·ç¾¤ç»„ã€ä¸€å¥—è¿›ç¨‹æ ‘ã€ç½‘ç»œã€è®¾å¤‡ä»¥åŠIPCå¯¹è±¡ã€‚</li>
</ul>
<h2 id="1-6-2006å¹´-â€”-Processå®¹å™¨">1.6 2006å¹´ â€” Processå®¹å™¨</h2>
<ul>
<li>Processå®¹å™¨äº2006å¹´ç”±è°·æ­Œå…¬å¸æ¨å‡ºï¼Œæ—¨åœ¨å¯¹ä¸€æ•´å¥—è¿›ç¨‹é›†åˆä¸­çš„èµ„æºä½¿ç”¨é‡(åŒ…æ‹¬CPUã€å†…å­˜ã€ç£ç›˜I/Oä»¥åŠç½‘ç»œç­‰ç­‰)åŠ ä»¥é™åˆ¶ã€åˆ†é…ä¸éš”ç¦»ã€‚</li>
<li>æ­¤åå…¶è¢«æ›´åä¸ºControl Groups(å³æ§åˆ¶ç»„)ï¼Œä»è€Œé¿å…å…¶ä¸­çš„â€œå®¹å™¨â€å­—çœ¼ä¸Linuxå†…æ ¸2.6.24ä¸­çš„å¦ä¸€æœ¯è¯­å‡ºç°å†²çªã€‚è¿™è¡¨æ˜äº†è°·æ­Œå…¬å¸ç‡å…ˆé‡è§†å®¹å™¨æŠ€æœ¯çš„æ•é”çœ¼å…‰ä»¥åŠä¸ºå…¶åšå‡ºçš„çªå‡ºè´¡çŒ®ã€‚</li>
</ul>
<h2 id="1-7-2007å¹´-â€”-Control-Groups">1.7 2007å¹´ â€” Control Groups</h2>
<p>Control Groupsä¹Ÿå°±æ˜¯è°·æ­Œå®ç°çš„cgroupsï¼Œå…¶äº2007å¹´è¢«æ·»åŠ è‡³Linuxå†…æ ¸å½“ä¸­ã€‚</p>
<h2 id="1-8-2008å¹´-â€”-LXC">1.8 2008å¹´ â€” LXC</h2>
<ul>
<li>LXCæŒ‡ä»£çš„æ˜¯Linux Containers</li>
<li>æ˜¯ç¬¬ä¸€å¥—å®Œæ•´çš„Linuxå®¹å™¨ç®¡ç†å®ç°æ–¹æ¡ˆã€‚</li>
<li>å…¶åŠŸèƒ½é€šè¿‡cgroupsä»¥åŠLinux namespaceså®ç°ã€‚</li>
<li>LXCé€šè¿‡liblxcåº“è¿›è¡Œäº¤ä»˜ï¼Œå¹¶æä¾›å¯ä¸Python3ã€Python2ã€Luaã€Goã€Rubyä»¥åŠHaskellç­‰è¯­è¨€ç›¸å¯¹æ¥çš„APIã€‚</li>
<li>ç›¸è¾ƒäºå…¶å®ƒå®¹å™¨æŠ€æœ¯ï¼ŒLXCèƒ½å¤Ÿåœ¨æ— éœ€ä»»ä½•é¢å¤–è¡¥ä¸çš„å‰æä¸‹è¿è¡Œåœ¨åŸç‰ˆLinuxå†…æ ¸ä¹‹ä¸Šã€‚</li>
</ul>
<h2 id="1-9-2011å¹´-â€”-Warden">1.9 2011å¹´ â€” Warden</h2>
<ul>
<li>Wardenç”±CloudFoundryå…¬å¸äº2011å¹´æ‰€å»ºç«‹ï¼Œå…¶åˆ©ç”¨LXCä½œä¸ºåˆå§‹é˜¶æ®µï¼Œéšååˆå°†å…¶æ›¿æ¢ä¸ºè‡ªå®¶å®ç°æ–¹æ¡ˆã€‚</li>
<li>ä¸LXCä¸åŒï¼ŒWardenå¹¶ä¸ä¼šä¸Linuxç´§å¯†è€¦åˆã€‚ç›¸åï¼Œå…¶èƒ½å¤Ÿè¿è¡Œåœ¨ä»»æ„èƒ½å¤Ÿæä¾›å¤šç§éš”ç¦»ç¯å¢ƒæ–¹å¼çš„æ“ä½œç³»ç»Ÿä¹‹ä¸Šã€‚Wardenä»¥åå°è¿›ç¨‹æ–¹å¼è¿è¡Œå¹¶æä¾›APIä»¥å®ç°å®¹å™¨ç®¡ç†ã€‚</li>
</ul>
<h2 id="1-10-2013å¹´-â€”-LMCTFY">1.10 2013å¹´ â€” LMCTFY</h2>
<ul>
<li>Lmctfyä»£è¡¨çš„æ˜¯â€œLet Me Contain That For You(å¸®ä½ å®ç°å®¹å™¨åŒ–)â€ã€‚å®ƒå…¶å®å±äºè°·æ­Œå®¹å™¨æŠ€æœ¯å †æ ˆçš„å¼€æºç‰ˆæœ¬ï¼Œè´Ÿè´£æä¾›Linuxåº”ç”¨ç¨‹åºå®¹å™¨ã€‚è°·æ­Œå…¬å¸åœ¨è¯¥é¡¹ç›®çš„èµ·æ­¥é˜¶æ®µå®£ç§°å…¶èƒ½å¤Ÿæä¾›å€¼å¾—ä¿¡èµ–çš„æ€§èƒ½è¡¨ç°ã€é«˜èµ„æºåˆ©ç”¨ç‡ã€å…±äº«èµ„æºæœºåˆ¶ã€å……è£•çš„å‘å±•ç©ºé—´ä»¥åŠè¶‹è¿‘äºé›¶çš„é¢å¤–èµ„æºæ¶ˆè€—ã€‚</li>
<li>2013å¹´10æœˆlmctfyçš„é¦–ä¸ªç‰ˆæœ¬æ­£å¼æ¨å‡ºï¼Œè°·æ­Œå…¬å¸åœ¨2015å¹´å†³å®šå°†lmctfyçš„æ ¸å¿ƒæ¦‚å¿µä¸æŠ½è±¡æœºåˆ¶è½¬åŒ–ä¸ºlibcontainerã€‚åœ¨å¤±å»äº†ä¸»å¹²ä¹‹åï¼Œå¦‚ä»Šlmctfyå·²ç»å¤±å»ä¸€åˆ‡ç§¯æçš„å‘å±•åŠ¿å¤´ã€‚</li>
</ul>
<p>Libcontaineré¡¹ç›®æœ€åˆç”±Dockerå…¬å¸å»ºç«‹ï¼Œå¦‚ä»Šå·²ç»è¢«å½’å…¥å¼€æ”¾å®¹å™¨åŸºé‡‘ä¼šçš„ç®¡è¾–èŒƒç•´ã€‚</p>
<h2 id="1-11-2013å¹´-Docker">1.11 2013å¹´-Docker</h2>
<ul>
<li>åœ¨2013å¹´Dockeråˆšå‘å¸ƒçš„æ—¶å€™ï¼Œå®ƒæ˜¯ä¸€æ¬¾åŸºäºLXCçš„å¼€æºå®¹å™¨ç®¡ç†å¼•æ“ã€‚</li>
<li>æŠŠLXCå¤æ‚çš„å®¹å™¨åˆ›å»ºä¸ä½¿ç”¨æ–¹å¼ç®€åŒ–ä¸ºDockerè‡ªå·±çš„ä¸€å¥—å‘½ä»¤ä½“ç³»ã€‚</li>
<li>éšç€Dockerçš„ä¸æ–­å‘å±•ï¼Œå®ƒå¼€å§‹æœ‰äº†æ›´ä¸ºè¿œå¤§çš„ç›®æ ‡ï¼Œé‚£å°±æ˜¯åå‘å®šä¹‰å®¹å™¨çš„å®ç°æ ‡å‡†ï¼Œå°†åº•å±‚å®ç°éƒ½æŠ½è±¡åŒ–åˆ°Libcontainerçš„æ¥å£ã€‚è¿™å°±æ„å‘³ç€ï¼Œåº•å±‚å®¹å™¨çš„å®ç°æ–¹å¼å˜æˆäº†ä¸€ç§å¯å˜çš„æ–¹æ¡ˆï¼Œæ— è®ºæ˜¯ä½¿ç”¨namespaceã€cgroupsæŠ€æœ¯æŠ‘æˆ–æ˜¯ä½¿ç”¨systemdç­‰å…¶ä»–æ–¹æ¡ˆï¼Œåªè¦å®ç°äº†Libcontainerå®šä¹‰çš„ä¸€ç»„æ¥å£ï¼ŒDockeréƒ½å¯ä»¥è¿è¡Œã€‚è¿™ä¹Ÿä¸ºDockerå®ç°å…¨é¢çš„è·¨å¹³å°å¸¦æ¥äº†å¯èƒ½ã€‚</li>
</ul>
<h1>äºŒã€NameSpace</h1>
<h2 id="2-1-NameSpaceä»‹ç»">2.1 NameSpaceä»‹ç»</h2>
<ul>
<li>
<p>å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½åŒ…å«äº†å‘½åç©ºé—´çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå‘½åç©ºé—´æ˜¯ä¸€ç§å°è£…ï¼Œå°è£…æœ¬èº«å®é™…ä¸Šå®ç°äº†ä»£ç çš„éš”ç¦»</p>
</li>
<li>
<p>åœ¨æ“ä½œç³»ç»Ÿä¸­å‘½åç©ºé—´å‘½åç©ºé—´æä¾›çš„æ˜¯ç³»ç»Ÿèµ„æºçš„éš”ç¦»ï¼Œå…¶ä¸­ç³»ç»Ÿèµ„æºåŒ…æ‹¬äº†ï¼šè¿›ç¨‹ã€ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿâ€¦</p>
</li>
<li>
<p>å®é™…ä¸Šlinuxç³»ç»Ÿå®ç°å‘½åç©ºé—´ä¸»è¦ç›®çš„ä¹‹ä¸€å°±æ˜¯ä¸ºäº†å®ç°è½»é‡çº§è™šæ‹ŸåŒ–æœåŠ¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„å®¹å™¨ï¼Œåœ¨åŒä¸€ä¸ªå‘½åç©ºé—´ä¸‹çš„è¿›ç¨‹å¯ä»¥æ„ŸçŸ¥å½¼æ­¤çš„å˜åŒ–ï¼Œè€Œå¯¹å…¶ä»–å‘½åç©ºé—´çš„è¿›ç¨‹ä¸€æ— æ‰€çŸ¥ï¼Œè¿™æ ·å°±å¯ä»¥è®©å®¹å™¨ä¸­çš„è¿›ç¨‹äº§ç”Ÿä¸€ä¸ªé”™è§‰ï¼Œä»¿ä½›å®ƒè‡ªå·±ç½®èº«äºä¸€ä¸ªç‹¬ç«‹çš„ç³»ç»Ÿç¯å¢ƒå½“ä¸­ï¼Œä»¥æ­¤è¾¾åˆ°ç‹¬ç«‹å’Œéš”ç¦»çš„ç›®çš„ã€‚</p>
</li>
</ul>
<h2 id="2-2-Linuxç³»ç»Ÿä¸­NameSpaceåˆ†ç±»">2.2 Linuxç³»ç»Ÿä¸­NameSpaceåˆ†ç±»</h2>
<table>
<thead>
<tr>
<th style="text-align:center">å‘½åç©ºé—´</th>
<th style="text-align:center">æè¿°</th>
<th style="text-align:center">ä½œç”¨</th>
<th style="text-align:center">å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">è¿›ç¨‹å‘½åç©ºé—´</td>
<td style="text-align:center">éš”ç¦»è¿›ç¨‹ID</td>
<td style="text-align:center">Linuxé€šè¿‡å‘½åç©ºé—´ç®¡ç†è¿›ç¨‹å·ï¼ŒåŒä¸€ä¸ªè¿›ç¨‹ï¼Œåœ¨ä¸åŒçš„å‘½åç©ºé—´è¿›ç¨‹å·ä¸åŒ</td>
<td style="text-align:center">è¿›ç¨‹å‘½åç©ºé—´æ˜¯ä¸€ä¸ªçˆ¶å­ç»“æ„ï¼Œå­ç©ºé—´å¯¹äºçˆ¶ç©ºé—´å¯è§</td>
</tr>
<tr>
<td style="text-align:center">ç½‘ç»œå‘½åç©ºé—´</td>
<td style="text-align:center">éš”ç¦»ç½‘ç»œè®¾å¤‡ã€åè®®æ ˆã€ç«¯å£ç­‰</td>
<td style="text-align:center">é€šè¿‡ç½‘ç»œå‘½åç©ºé—´ï¼Œå®ç°ç½‘ç»œéš”ç¦»</td>
<td style="text-align:center">dockeré‡‡ç”¨è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œå°†ä¸åŒå‘½åç©ºé—´çš„ç½‘ç»œè®¾å¤‡è¿æ¥åˆ°ä¸€èµ·</td>
</tr>
<tr>
<td style="text-align:center">IPCå‘½åç©ºé—´</td>
<td style="text-align:center">éš”ç¦»è¿›ç¨‹é—´é€šä¿¡</td>
<td style="text-align:center">è¿›ç¨‹é—´äº¤äº’æ–¹æ³•</td>
<td style="text-align:center">PIDå‘½åç©ºé—´å’ŒIPCå‘½åç©ºé—´å¯ä»¥ç»„åˆèµ·æ¥ç”¨ï¼ŒåŒä¸€ä¸ªIPCåå­—ç©ºé—´å†…çš„è¿›ç¨‹å¯ä»¥å½¼æ­¤çœ‹è§ï¼Œå…è®¸è¿›è¡Œäº¤äº’ï¼Œä¸åŒç©ºé—´è¿›ç¨‹æ— æ³•äº¤äº’</td>
</tr>
<tr>
<td style="text-align:center">æŒ‚è½½å‘½åç©ºé—´</td>
<td style="text-align:center">éš”ç¦»æŒ‚è½½ç‚¹</td>
<td style="text-align:center">éš”ç¦»æ–‡ä»¶ç›®å½•</td>
<td style="text-align:center">è¿›ç¨‹è¿è¡Œæ—¶å¯ä»¥å°†æŒ‚è½½ç‚¹ä¸ç³»ç»Ÿåˆ†ç¦»ï¼Œä½¿ç”¨è¿™ä¸ªåŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è¾¾åˆ° chroot çš„åŠŸèƒ½ï¼Œè€Œåœ¨å®‰å…¨æ€§æ–¹é¢æ¯” chroot æ›´é«˜</td>
</tr>
<tr>
<td style="text-align:center">UTSå‘½åç©ºé—´</td>
<td style="text-align:center">éš”ç¦»Hostnameå’ŒNISåŸŸå</td>
<td style="text-align:center">è®©å®¹å™¨æ‹¥æœ‰ç‹¬ç«‹çš„ä¸»æœºåå’ŒåŸŸåï¼Œä»è€Œè®©å®¹å™¨çœ‹èµ·æ¥åƒä¸ªç‹¬ç«‹çš„ä¸»æœº</td>
<td style="text-align:center">ç›®çš„æ˜¯ç‹¬ç«‹å‡ºä¸»æœºåå’Œç½‘ç»œä¿¡æ¯æœåŠ¡ï¼ˆNISï¼‰</td>
</tr>
<tr>
<td style="text-align:center">ç”¨æˆ·å‘½åç©ºé—´</td>
<td style="text-align:center">éš”ç¦»ç”¨æˆ·å’Œgroup ID</td>
<td style="text-align:center">æ¯ä¸ªå®¹å™¨å†…ä¸Šçš„ç”¨æˆ·è·Ÿå®¿ä¸»ä¸»æœºä¸Šä¸åœ¨ä¸€ä¸ªå‘½åç©ºé—´</td>
<td style="text-align:center">åŒè¿›ç¨‹ ID ä¸€æ ·ï¼Œç”¨æˆ· ID å’Œç»„ ID åœ¨å‘½åç©ºé—´å†…å¤–æ˜¯ä¸ä¸€æ ·çš„ï¼Œå¹¶ä¸”åœ¨ä¸åŒå‘½åç©ºé—´å†…å¯ä»¥å­˜åœ¨ç›¸åŒçš„ ID</td>
</tr>
</tbody>
</table>
<h2 id="2-3-NameSpaceåº”ç”¨æ¡ˆä¾‹">2.3 NameSpaceåº”ç”¨æ¡ˆä¾‹</h2>
<blockquote>
<p>ä»¥net namespaceä¸ºä¾‹</p>
</blockquote>
<ul>
<li>åœ¨ Linux ä¸­ï¼Œç½‘ç»œå‘½åç©ºé—´å¯ä»¥è¢«è®¤ä¸ºæ˜¯éš”ç¦»çš„æ‹¥æœ‰å•ç‹¬ç½‘ç»œæ ˆï¼ˆç½‘å¡ã€è·¯ç”±è½¬å‘è¡¨ã€iptablesï¼‰çš„ç¯å¢ƒã€‚ç½‘ç»œå‘½åç©ºé—´ç»å¸¸ç”¨æ¥éš”ç¦»ç½‘ç»œè®¾å¤‡å’ŒæœåŠ¡ï¼Œåªæœ‰æ‹¥æœ‰åŒæ ·ç½‘ç»œå‘½åç©ºé—´çš„è®¾å¤‡ï¼Œæ‰èƒ½çœ‹åˆ°å½¼æ­¤ã€‚</li>
<li>ä»é€»è¾‘ä¸Šè¯´ï¼Œç½‘ç»œå‘½åç©ºé—´æ˜¯ç½‘ç»œæ ˆçš„å‰¯æœ¬ï¼Œæ‹¥æœ‰è‡ªå·±çš„ç½‘ç»œè®¾å¤‡ã€è·¯ç”±é€‰æ‹©è¡¨ã€é‚»æ¥è¡¨ã€Netfilterè¡¨ã€ç½‘ç»œå¥—æ¥å­—ã€ç½‘ç»œprocfsæ¡ç›®ã€ç½‘ç»œsysfsæ¡ç›®å’Œå…¶ä»–ç½‘ç»œèµ„æºã€‚</li>
<li>ä»ç³»ç»Ÿçš„è§’åº¦æ¥çœ‹ï¼Œå½“é€šè¿‡clone()ç³»ç»Ÿè°ƒç”¨åˆ›å»ºæ–°è¿›ç¨‹æ—¶ï¼Œä¼ é€’æ ‡å¿—CLONE_NEWNETå°†åœ¨æ–°è¿›ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ç½‘ç»œå‘½åç©ºé—´ã€‚</li>
<li>ä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬åªéœ€ä½¿ç”¨å·¥å…·ipï¼ˆpackage is iproute2ï¼‰æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„æŒä¹…ç½‘ç»œå‘½åç©ºé—´ã€‚</li>
</ul>
<p><a href="%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E6%89%80%E6%B6%89%E5%8F%8ALinux%E5%86%85%E6%A0%B8%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF.assets/image-20220111132707215.png" title="image-20220111132707215" class="gallery-item" style="box-shadow: none;"> <img src="/2023/06/04/%E8%BF%90%E7%BB%B4/%E5%AE%B9%E5%99%A8/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E6%89%80%E6%B6%89%E5%8F%8ALinux%E5%86%85%E6%A0%B8%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF//image-20220111132707215.png" alt="image-20220111132707215"></a></p>
<h3 id="2-3-1-åˆ›å»ºnetå‘½åç©ºé—´">2.3.1 åˆ›å»ºnetå‘½åç©ºé—´</h3>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºåç§°ä¸ºmsbçš„ç½‘ç»œå‘½åç©ºé—´</span><br><span class="line"><span class="comment"># ip netns add msb</span></span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹å·²åˆ›å»ºçš„ç½‘ç»œå‘½åç©ºé—´</span><br><span class="line"><span class="comment"># ip netns ls</span></span><br><span class="line">msb</span><br></pre></td></tr></table></figure>
<h3 id="2-3-2-åˆ é™¤netå‘½åç©ºé—´">2.3.2 åˆ é™¤netå‘½åç©ºé—´</h3>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åˆ é™¤å·²åˆ›å»ºçš„ç½‘ç»œå‘½åç©ºé—´</span><br><span class="line"><span class="comment"># ip netns delete msb</span></span><br></pre></td></tr></table></figure>
<h3 id="2-3-3-åœ¨netå‘½åç©ºé—´ä¸­æ‰§è¡Œå‘½ä»¤">2.3.3 åœ¨netå‘½åç©ºé—´ä¸­æ‰§è¡Œå‘½ä»¤</h3>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ç½‘ç»œå‘½åç©ºé—´ä¸­æ‰§è¡Œbashå‘½ä»¤ï¼Œå¦‚æœæƒ³é€€å‡ºï¼Œéœ€è¦ä½¿ç”¨<span class="keyword">exit</span></span><br><span class="line"><span class="comment"># ip netns exec msb bash</span></span><br></pre></td></tr></table></figure>
<h3 id="2-3-4-åœ¨netå‘½ä»¤ç©ºé—´ä¸­æ‰§è¡ŒæŸ¥çœ‹ç½‘ç»œè¿æ¥-ç½‘å¡-å‘½ä»¤">2.3.4 åœ¨netå‘½ä»¤ç©ºé—´ä¸­æ‰§è¡ŒæŸ¥çœ‹ç½‘ç»œè¿æ¥(ç½‘å¡)å‘½ä»¤</h3>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ç½‘ç»œå‘½åç©ºé—´ä¸­æŸ¥çœ‹ç½‘ç»œå‘½åç©ºé—´ä¸­çš„ç½‘å¡ä¿¡æ¯</span><br><span class="line"><span class="comment"># ip link</span></span><br><span class="line"><span class="number">1</span>: lo: &lt;LOOPBACK&gt; mtu <span class="number">65536</span> qdisc noop state DOWN mode DEFAULT <span class="built_in">group</span> default qlen <span class="number">1000</span></span><br><span class="line">    link/loopback <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åœ¨Linuxä¸»æœºç³»ç»Ÿä¸­æŸ¥çœ‹</span><br><span class="line"><span class="comment"># ip netns exec msb ip link list</span></span><br><span class="line"><span class="number">1</span>: lo: &lt;LOOPBACK&gt; mtu <span class="number">65536</span> qdisc noop state DOWN mode DEFAULT <span class="built_in">group</span> default qlen <span class="number">1000</span></span><br><span class="line">    link/loopback <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>
<h3 id="2-3-5-é€€å‡ºå½“å‰çš„netå‘½åç©ºé—´">2.3.5 é€€å‡ºå½“å‰çš„netå‘½åç©ºé—´</h3>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é€€å‡ºå·²è¿›å…¥çš„ç½‘ç»œå‘½åç©ºé—´</span><br><span class="line"><span class="comment"># exit</span></span><br><span class="line"><span class="keyword">exit</span></span><br></pre></td></tr></table></figure>
<h3 id="2-3-6-åœ¨netå‘½åç©ºé—´ä¸­æ‰§è¡Œå¤šæ¡å‘½ä»¤">2.3.6 åœ¨netå‘½åç©ºé—´ä¸­æ‰§è¡Œå¤šæ¡å‘½ä»¤</h3>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ç½‘ç»œå‘½åç©ºé—´ä¸­æŸ¥çœ‹è·¯ç”±è¡¨</span><br><span class="line"><span class="comment"># route -n</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ç½‘ç»œå‘½åç©ºé—´ä¸­æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™</span><br><span class="line"><span class="comment"># iptables -t nat -nL</span></span><br><span class="line">Chain PREROUTING (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain POSTROUTING (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination</span><br></pre></td></tr></table></figure>
<h3 id="2-3-7-åˆ›å»ºè™šæ‹Ÿç½‘å¡">2.3.7 åˆ›å»ºè™šæ‹Ÿç½‘å¡</h3>
<blockquote>
<p>åŒæ—¶åˆ›å»ºä¸€å¯¹è™šæ‹Ÿç½‘å¡</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºè™šæ‹Ÿç½‘å¡å¯¹</span><br><span class="line"><span class="comment"># ip link add veth0 type veth peer name veth1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ç‰©ç†æœºä¸ŠæŸ¥çœ‹</span><br><span class="line"><span class="comment"># ip a s</span></span><br><span class="line">......</span><br><span class="line"><span class="number">10</span>: veth1@veth0: &lt;BROADCAST,MULTICAST,M<span class="literal">-DOWN</span>&gt; mtu <span class="number">1500</span> qdisc noop state DOWN <span class="built_in">group</span> default qlen <span class="number">1000</span></span><br><span class="line">    link/ether de:<span class="number">44</span>:f8:b7:<span class="number">12</span>:<span class="number">65</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line"><span class="number">11</span>: veth0@veth1: &lt;BROADCAST,MULTICAST,M<span class="literal">-DOWN</span>&gt; mtu <span class="number">1500</span> qdisc noop state DOWN <span class="built_in">group</span> default qlen <span class="number">1000</span></span><br><span class="line">    link/ether <span class="number">46</span>:<span class="number">5</span>e:<span class="number">89</span>:<span class="number">8</span>c:cb:b3 brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure>
<h3 id="2-3-8-è¿ç§»è™šæ‹Ÿç½‘å¡åˆ°å‘½åç©ºé—´ä¸­">2.3.8 è¿ç§»è™šæ‹Ÿç½‘å¡åˆ°å‘½åç©ºé—´ä¸­</h3>
<blockquote>
<p>è¿™ä¸¤ä¸ªç½‘å¡è¿˜éƒ½å±äºâ€œdefaultâ€æˆ–â€œglobalâ€å‘½åç©ºé—´ï¼Œå’Œç‰©ç†ç½‘å¡ä¸€æ ·ã€‚æŠŠå…¶ä¸­ä¸€ä¸ªç½‘å¡è½¬ç§»åˆ°å‘½åç©ºé—´msbä¸­ã€‚</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æŠŠåˆ›å»ºçš„veth1ç½‘å¡æ·»åŠ åˆ°msbç½‘ç»œå‘½åç©ºé—´ä¸­</span><br><span class="line"><span class="comment"># ip link set veth1 netns msb</span></span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åœ¨Linuxç³»ç»Ÿå‘½ä»¤è¡ŒæŸ¥çœ‹ç½‘ç»œå‘½åç©ºé—´ä¸­çš„ç½‘ç»œ</span><br><span class="line"><span class="comment"># ip netns exec msb ip link</span></span><br><span class="line"><span class="number">1</span>: lo: &lt;LOOPBACK&gt; mtu <span class="number">65536</span> qdisc noop state DOWN mode DEFAULT <span class="built_in">group</span> default qlen <span class="number">1000</span></span><br><span class="line">    link/loopback <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">10</span>: veth1@if11: &lt;BROADCAST,MULTICAST&gt; mtu <span class="number">1500</span> qdisc noop state DOWN mode DEFAULT <span class="built_in">group</span> default qlen <span class="number">1000</span></span><br><span class="line">    link/ether de:<span class="number">44</span>:f8:b7:<span class="number">12</span>:<span class="number">65</span> brd ff:ff:ff:ff:ff:ff link<span class="literal">-netnsid</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h3 id="2-3-9-å‘½åç©ºé—´ä¸­è¿å‡ºè™šæ‹Ÿç½‘å¡">2.3.9 å‘½åç©ºé—´ä¸­è¿å‡ºè™šæ‹Ÿç½‘å¡</h3>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åœ¨Linuxç³»ç»Ÿå‘½ä»¤è¡ŒæŠŠè™šæ‹Ÿç½‘å¡veth1ä»ç½‘ç»œå‘½åç©ºé—´åˆ é™¤</span><br><span class="line"><span class="comment"># ip netns exec msb ip link delete veth1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åœ¨Linuxç³»ç»Ÿå‘½ä»¤è¡ŒæŸ¥çœ‹ç»“æœ</span><br><span class="line"><span class="comment"># ip netns exec msb ip link</span></span><br><span class="line"><span class="number">1</span>: lo: &lt;LOOPBACK&gt; mtu <span class="number">65536</span> qdisc noop state DOWN mode DEFAULT <span class="built_in">group</span> default qlen <span class="number">1000</span></span><br><span class="line">    link/loopback <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>
<h3 id="2-3-10-é…ç½®è™šæ‹Ÿç½‘å¡IPåœ°å€">2.3.10 é…ç½®è™šæ‹Ÿç½‘å¡IPåœ°å€</h3>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å†æ¬¡åˆ›å»ºè™šæ‹Ÿç½‘å¡ï¼Œæ·»åŠ åˆ°msbç½‘ç»œå‘½åç©ºé—´ï¼Œå¹¶è®¾ç½®IPåœ°å€</span><br><span class="line"><span class="comment"># ip link add veth0 type veth peer name veth1</span></span><br><span class="line"><span class="comment"># ip link set veth1 netns msb</span></span><br><span class="line"><span class="comment"># ip netns exec msb ip addr add 192.168.50.2/24 dev veth1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">åœ¨Linuxç³»ç»Ÿå‘½ä»¤è¡ŒæŸ¥çœ‹ç½‘ç»œçŠ¶æ€</span><br><span class="line"><span class="comment"># ip netns exec msb ip addr</span></span><br><span class="line"><span class="number">1</span>: lo: &lt;LOOPBACK&gt; mtu <span class="number">65536</span> qdisc noop state DOWN <span class="built_in">group</span> default qlen <span class="number">1000</span></span><br><span class="line">    link/loopback <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">12</span>: veth1@if13: &lt;BROADCAST,MULTICAST&gt; mtu <span class="number">1500</span> qdisc noop state DOWN <span class="built_in">group</span> default qlen <span class="number">1000</span></span><br><span class="line">    link/ether fe:<span class="number">20</span>:<span class="built_in">ac</span>:a8:<span class="number">13</span>:<span class="number">4</span>c brd ff:ff:ff:ff:ff:ff link<span class="literal">-netnsid</span> <span class="number">0</span></span><br><span class="line">    inet <span class="number">192.168</span>.<span class="number">50.2</span>/<span class="number">24</span> scope global veth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¯åŠ¨è™šæ‹Ÿç½‘å¡,veth1ä¸loå…¨éƒ¨è¦å¯åŠ¨</span><br><span class="line"><span class="comment"># ip netns exec msb ip link set veth1 up</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ip netns exec msb ip link set lo up</span></span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ä¸ºç‰©ç†æœºveth0æ·»åŠ IPåœ°å€</span><br><span class="line"></span><br><span class="line"><span class="comment"># ip a s</span></span><br><span class="line">......</span><br><span class="line"><span class="number">15</span>: veth0@if14: &lt;BROADCAST,MULTICAST&gt; mtu <span class="number">1500</span> qdisc noop state DOWN <span class="built_in">group</span> defau</span><br><span class="line">lt qlen <span class="number">1000</span></span><br><span class="line">    link/ether <span class="number">2</span>e:b4:<span class="number">40</span>:c8:<span class="number">73</span>:dc brd ff:ff:ff:ff:ff:ff link<span class="literal">-netnsid</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip addr add 192.168.50.3/24 dev veth0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ip a s veth0</span></span><br><span class="line"><span class="number">15</span>: veth0@if14: &lt;BROADCAST,MULTICAST&gt; mtu <span class="number">1500</span> qdisc noop state DOWN <span class="built_in">group</span> default qlen <span class="number">1000</span></span><br><span class="line">    link/ether <span class="number">2</span>e:b4:<span class="number">40</span>:c8:<span class="number">73</span>:dc brd ff:ff:ff:ff:ff:ff link<span class="literal">-netnsid</span> <span class="number">0</span></span><br><span class="line">    inet <span class="number">192.168</span>.<span class="number">50.3</span>/<span class="number">24</span> scope global veth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip link set veth0 up</span></span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åœ¨å®¿ä¸»æœºä¸Šping msbä¸­çš„veth1</span><br><span class="line"><span class="comment"># ping 192.168.50.2</span></span><br><span class="line">PING <span class="number">192.168</span>.<span class="number">50.2</span> (<span class="number">192.168</span>.<span class="number">50.2</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of <span class="keyword">data</span>.</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">192.168</span>.<span class="number">50.2</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">0.102</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">192.168</span>.<span class="number">50.2</span>: icmp_seq=<span class="number">2</span> ttl=<span class="number">64</span> time=<span class="number">0.068</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">192.168</span>.<span class="number">50.2</span>: icmp_seq=<span class="number">3</span> ttl=<span class="number">64</span> time=<span class="number">0.068</span> ms</span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åœ¨msbä¸­çš„veth1 ping å®¿ä¸»æœºä¸Šveth0</span><br><span class="line"><span class="comment"># ip netns exec msb ping 192.168.50.3</span></span><br><span class="line">PING <span class="number">192.168</span>.<span class="number">50.3</span> (<span class="number">192.168</span>.<span class="number">50.3</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of <span class="keyword">data</span>.</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">192.168</span>.<span class="number">50.3</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">0.053</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">192.168</span>.<span class="number">50.3</span>: icmp_seq=<span class="number">2</span> ttl=<span class="number">64</span> time=<span class="number">0.031</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">192.168</span>.<span class="number">50.3</span>: icmp_seq=<span class="number">3</span> ttl=<span class="number">64</span> time=<span class="number">0.029</span> ms</span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœéœ€è¦è®¿é—®æœ¬æœºçš„å…¶å®ƒç½‘æ®µï¼Œå¯æ‰‹åŠ¨æ·»åŠ å¦‚ä¸‹é»˜è®¤è·¯ç”±æ¡ç›®ã€‚</span><br><span class="line"><span class="comment"># ip netns exec msb ip route add default via 192.168.50.3</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>å…³äºå¦‚ä½•pingé€šå¤–ç½‘ä¸»æœºï¼Œå¯è®¾ç½®è·¯ç”±è½¬å‘å®Œæˆã€‚</p>
</blockquote>
<h1>ä¸‰ã€CGroups</h1>
<h2 id="3-1-CGroupsä»‹ç»">3.1 CGroupsä»‹ç»</h2>
<ul>
<li>
<p>Control groups(cgroups) æ§åˆ¶ç»„</p>
</li>
<li>
<p>linuxå†…æ ¸æä¾›çš„å¯ä»¥é™åˆ¶ã€è®°å½•ã€éš”ç¦»è¿›ç¨‹ç»„æ‰€ä½¿ç”¨çš„ç‰©ç†èµ„æºçš„æœºåˆ¶ã€‚ä¸ºå®¹å™¨è€Œç”Ÿï¼Œæ²¡æœ‰cgroupså°±æ²¡æœ‰ä»Šå¤©çš„å®¹å™¨æŠ€æœ¯ã€‚</p>
</li>
</ul>
<p><a href="%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E6%89%80%E6%B6%89%E5%8F%8ALinux%E5%86%85%E6%A0%B8%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF.assets/image-20220112182824405.png" title="image-20220112182824405" class="gallery-item" style="box-shadow: none;"> <img src="/2023/06/04/%E8%BF%90%E7%BB%B4/%E5%AE%B9%E5%99%A8/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E6%89%80%E6%B6%89%E5%8F%8ALinux%E5%86%85%E6%A0%B8%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF//image-20220112182824405.png" alt="image-20220112182824405"></a></p>
<h2 id="3-2-CGroupsåŠŸèƒ½">3.2 CGroupsåŠŸèƒ½</h2>
<ul>
<li>èµ„æºé™åˆ¶ï¼ˆResource Limitationï¼‰ï¼šcgroups å¯ä»¥å¯¹è¿›ç¨‹ç»„ä½¿ç”¨çš„èµ„æºæ€»é¢è¿›è¡Œé™åˆ¶ã€‚å¦‚è®¾å®šåº”ç”¨è¿è¡Œæ—¶ä½¿ç”¨å†…å­˜çš„ä¸Šé™ï¼Œä¸€æ—¦è¶…è¿‡è¿™ä¸ªé…é¢å°±å‘å‡º OOMï¼ˆOut of Memoryï¼‰ã€‚</li>
<li>ä¼˜å…ˆçº§åˆ†é…ï¼ˆPrioritizationï¼‰ï¼šé€šè¿‡åˆ†é…çš„ CPU æ—¶é—´ç‰‡æ•°é‡åŠç¡¬ç›˜ IO å¸¦å®½å¤§å°ï¼Œå®é™…ä¸Šå°±ç›¸å½“äºæ§åˆ¶äº†è¿›ç¨‹è¿è¡Œçš„ä¼˜å…ˆçº§ã€‚</li>
<li>èµ„æºç»Ÿè®¡ï¼ˆAccountingï¼‰ï¼š cgroups å¯ä»¥ç»Ÿè®¡ç³»ç»Ÿçš„èµ„æºä½¿ç”¨é‡ï¼Œå¦‚ CPU ä½¿ç”¨æ—¶é•¿ã€å†…å­˜ç”¨é‡ç­‰ç­‰ï¼Œè¿™ä¸ªåŠŸèƒ½éå¸¸é€‚ç”¨äºè®¡è´¹ã€‚</li>
<li>è¿›ç¨‹æ§åˆ¶ï¼ˆControlï¼‰ï¼šcgroups å¯ä»¥å¯¹è¿›ç¨‹ç»„æ‰§è¡ŒæŒ‚èµ·ã€æ¢å¤ç­‰æ“ä½œã€‚</li>
</ul>
<h2 id="3-3-CGroupsåº”ç”¨æ¡ˆä¾‹">3.3 CGroupsåº”ç”¨æ¡ˆä¾‹</h2>
<h3 id="3-3-1-å®‰è£…åŠå¼€å¯æœåŠ¡">3.3.1 å®‰è£…åŠå¼€å¯æœåŠ¡</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum -y install libcgroup</span><br><span class="line">[root@localhost ~]# systemctl start cgconfig.service     </span><br><span class="line">[root@localhost ~]# systemctl enable cgconfig.service</span><br></pre></td></tr></table></figure>
<h3 id="3-3-2-é™åˆ¶è¿›ç¨‹ä½¿ç”¨CPU">3.3.2 é™åˆ¶è¿›ç¨‹ä½¿ç”¨CPU</h3>
<h4 id="3-3-2-1-æŸ¥çœ‹cpu-shares">3.3.2.1 æŸ¥çœ‹cpu shares</h4>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹èµ„æºé™åˆ¶å­ç³»ç»Ÿ</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># lssubsys</span></span><br><span class="line">cpuset</span><br><span class="line">cpu,cpuacct</span><br><span class="line">memory</span><br><span class="line">devices</span><br><span class="line">freezer</span><br><span class="line">net_cls,net_prio</span><br><span class="line">blkio</span><br><span class="line">perf_event</span><br><span class="line">hugetlb</span><br><span class="line">pids</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹å­ç³»ç»Ÿé…ç½®æ–‡ä»¶æ‰€åœ¨ä½ç½®</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># ls /sys/fs/cgroup/</span></span><br><span class="line">blkio  cpuacct      cpuset   freezer  memory   net_cls,net_prio  perf_event  systemd</span><br><span class="line">cpu    cpu,cpuacct  devices  hugetlb  net_cls  net_prio          pids</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># ls /sys/fs/cgroup/cpu</span></span><br><span class="line">cgroup.clone_children  cpuacct.stat          cpu.cfs_quota_us   cpu.stat</span><br><span class="line">cgroup.event_control   cpuacct.usage         cpu.rt_period_us   notify_on_release</span><br><span class="line">cgroup.procs           cpuacct.usage_percpu  cpu.rt_runtime_us  release_agent</span><br><span class="line">cgroup.sane_behavior   cpu.cfs_period_us     cpu.shares         tasks</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹CPUæ—¶é—´åˆ†ç‰‡ï¼Œç”¨äºä¿è¯åˆ†ç»„æ‰€å¾—åˆ°çš„CPUåˆ†ç‰‡æ€»é‡ã€‚</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># cat /sys/fs/cgroup/cpu/cpu.shares</span></span><br><span class="line"><span class="number">1024</span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-2-2-ä½¿ç”¨CPUå­ç³»ç»Ÿåˆ›å»º2ä¸ªgroupåˆ†ç»„">3.3.2.2 ä½¿ç”¨CPUå­ç³»ç»Ÿåˆ›å»º2ä¸ªgroupåˆ†ç»„</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/cgconfig.conf</span><br><span class="line">group lesscpu &#123;</span><br><span class="line">    cpu&#123;</span><br><span class="line">        cpu.shares=200;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line">group morecpu &#123;</span><br><span class="line">    cpu&#123;</span><br><span class="line">        cpu.shares=800;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# systemctl restart cgconfig</span><br></pre></td></tr></table></figure>
<p>å‡†å¤‡ä¸€ä¸ªè„šæœ¬</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=<span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> true</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">        a=<span class="variable">$</span>[<span class="variable">$a</span>+<span class="number">1</span>]</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>å°†å°†è¦è¿è¡Œçš„åº”ç”¨ç¨‹åºåˆ†é…åˆ°æŒ‡å®šåˆ†ç»„(<strong>è¯·ä½¿ç”¨å•CPUæœºå™¨,ä¸‰ä¸ªç»ˆç«¯éªŒè¯</strong>)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç»ˆç«¯1# cgexec -g cpu:lesscpu sh /tmp/1.sh</span><br><span class="line"></span><br><span class="line">ç»ˆç«¯2# cgexec -g cpu:morecpu sh /tmp/1.sh</span><br><span class="line"></span><br><span class="line">ç»ˆç«¯3# top</span><br></pre></td></tr></table></figure>
<p><strong>PS: å¦‚æœä¸»æœºæœ‰å¤šCPUï¼Œä¸ºäº†éªŒè¯æ•ˆæœï¼Œå¯ä»¥è¿›è¡Œå¦‚ä¸‹æ“ä½œ</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">lscpu</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> 0 &gt; /sys/devices/system/cpu/cpu0/online</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> 1 &gt; /sys/devices/system/cpu/cpu1/online</span></span><br></pre></td></tr></table></figure>
</div>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-06-04</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« albert dong</span>
            
            
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='../../../../../../categories/%E5%AE%B9%E5%99%A8/'>
                            å®¹å™¨
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    
        
            
    
            <div class="post-footer-pre-next">
                
                    <span>ä¸Šä¸€ç¯‡ï¼š<a href='../%E5%BA%94%E7%94%A8%EF%BC%88APP%EF%BC%89%E9%83%A8%E7%BD%B2%E5%AE%B9%E5%99%A8%E5%8C%96%E6%BC%94%E8%BF%9B%E4%B9%8B%E8%B7%AF/'>å®¹å™¨çš„æ¼”è¿›å‘å±•</a></span>
                

                
                    <span class="post-footer-pre-next-last-span-right">ä¸‹ä¸€ç¯‡ï¼š<a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MYSQL%20performance%20schema%E8%AF%A6%E8%A7%A3/">MYSQL performance schemaè¯¦è§£</a>
                    </span>
                
            </div>
    
        
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 1949-2024 China 

            
                

            
        </span>
       
    
</div>



<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>ğŸŒŠçœ‹è¿‡å¤§æµ·çš„äººä¸ä¼šå¿˜è®°æµ·çš„å¹¿é˜”ğŸŒŠ</span>
            
                <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="../../../../../../js/toc.js"></script>

    

    
<script src="../../../../../../js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="../../../../../../js/returnToTop.js"></script>

    

    
        
<script src="../../../../../../js/returnToLastPage.js"></script>

    





<script src="../../../../../../js/lightgallery/lightgallery.umd.min.js"></script>



<script src="../../../../../../js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script>



<script src="../../../../../../js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script>


<script src="../../../../../../js/lightgallery/plugins/lg-autoplay.umd.min.js"></script>


<script src="../../../../../../js/lightgallery/plugins/lg-zoom.umd.min.js"></script>


<script src="../../../../../../js/lightgallery/plugins/lg-rotate.umd.min.js"></script>


<script src="../../../../../../js/lightgallery/plugins/lg-paper.umd.min.js"></script>




<script type="text/javascript">
     
    if (typeof lightGallery !== "undefined") {
        var options1 = {
            selector: '.gallery-item',
            plugins: [lgThumbnail, lgFullscreen, lgAutoplay, lgZoom, lgRotate, lgPager], // å¯ç”¨æ’ä»¶
            thumbnail: true,          // æ˜¾ç¤ºç¼©ç•¥å›¾
            zoom: true,               // å¯ç”¨ç¼©æ”¾åŠŸ
            rotate: true,             // å¯ç”¨æ—‹è½¬åŠŸèƒ½èƒ½
            autoplay: true,        // å¯ç”¨è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½
            fullScreen: true,      // å¯ç”¨å…¨å±åŠŸèƒ½
            pager: false, //é¡µç ,
            zoomFromOrigin: true,   // ä»åŸå§‹ä½ç½®ç¼©æ”¾
            actualSize: true,       // å¯ç”¨æŸ¥çœ‹å®é™…å¤§å°çš„åŠŸèƒ½
            enableZoomAfter: 300,    // å»¶è¿Ÿç¼©æ”¾ï¼Œç¡®ä¿å›¾ç‰‡åŠ è½½å®Œæˆåå¯ç¼©æ”¾
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1); // ä¿®å¤é€‰æ‹©å™¨
    }
    
</script>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> 

                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>